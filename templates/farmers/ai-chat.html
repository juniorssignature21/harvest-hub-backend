<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Abiagrow.connect â€” Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />
    <style>
      /* small custom tweaks */
      .card-blur {
        backdrop-filter: blur(6px);
      }
      /* Tooltip */
      .tooltip {
        position: relative;
        display: inline-block;
      }
      .tooltip .tooltip-text {
        visibility: hidden;
        width: 220px;
        background-color: rgba(31, 41, 55, 0.95);
        color: #fff;
        text-align: left;
        border-radius: 8px;
        padding: 8px 10px;
        position: absolute;
        z-index: 50;
        bottom: 125%;
        left: 50%;
        transform: translateX(-50%);
        font-size: 13px;
        line-height: 1.2;
        opacity: 0;
        transition: opacity 0.15s ease, visibility 0.15s;
      }
      .tooltip:hover .tooltip-text {
        visibility: visible;
        opacity: 1;
      }

      /* Animations */
      @keyframes fadeIn {
        0% {
          opacity: 0;
          transform: translateY(5px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .animate-fade-in {
        animation: fadeIn 0.3s ease forwards;
      }

      @keyframes bounceSlow {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-5px);
        }
      }
      .animate-bounce-slow {
        animation: bounceSlow 1s infinite;
      }
    </style>
  </head>
  <body class="bg-white font-sans antialiased text-gray-800">
    <div class="min-h-screen flex">
      <!-- Sidebar -->
       <aside
        class="w-72 bg-gray-100 border-r border-green-100 p-6 flex flex-col justify-between"
      >
        <div>
          <div class="flex items-center space-x-3 mb-6">
            <div
              class="w-10 h-10 rounded-full bg-green-700 flex items-center justify-center text-white text-lg font-bold"
            >
              A
            </div>
            <div>
              <div class="font-bold text-lg text-green-800">AgroMind</div>
              <div class="text-sm text-green-500">Abiagrow.connect</div>
            </div>
          </div>

          <div class="flex items-center space-x-3 mb-5">
            <img
              alt="avatar"
              class="w-12 h-12 rounded-full ring-2 ring-green-200"
              src="https://i.pravatar.cc/100?img=12"
            />
            <div>
              <div class="font-semibold text-green-900">Ghost Farmer</div>
              <div class="text-sm text-green-500">Green Valley Farms</div>
            </div>
          </div>

          <nav class="mt-4 space-y-2">
            <a
              class="flex items-center gap-3 px-3 py-4 rounded-lg bg-green-100 text-green-800 font-semibold hover:bg-green-500/60"
              href="dashboard.html"
            >
              <i class="fa-solid fa-chart-line w-5 text-green-700"></i>
              Dashboard
            </a>
            <a
              class="flex items-center gap-3 px-3 py-4 rounded-lg hover:bg-green-50 text-green-700 hover:bg-green-500/60"
              href="viewproducts.html"
            >
              <i class="fa-solid fa-seedling w-5"></i>
              View Products
            </a>
            <a
              class="flex items-center gap-3 px-3 py-4 rounded-lg hover:bg-green-50 text-green-700 hover:bg-green-500/60"
              href="weather.html"
            >
              <i class="fa-solid fa-cloud-sun-rain w-5"></i>
              Weather
            </a>
            <a
              class="flex items-center gap-3 px-3 py-4 rounded-lg hover:bg-green-50 text-green-700 hover:bg-green-500/60"
              href="soilanalysis.html"
            >
              <i class="fa-solid fa-flask w-5"></i>
              Soil Analysis
            </a>
            <a
              class="flex items-center gap-3 px-3 py-4 rounded-lg hover:bg-green-50 text-green-700 hover:bg-green-500/60"
              href="settings.html"
            >
              <i class="fa-solid fa-gear w-5"></i>
              Settings
            </a>
          </nav>

          <div class="mt-6">
            <button
              class="w-full text-left px-3 py-4 rounded-lg bg-green-100 text-green-800 flex items-center gap-3 hover:bg-green-500/60"
              id="analyzeCropBtn"
            >
              <i class="fa-solid fa-image"></i> Analyze Crop Image
            </button>

            <a href="ai-chat.html">
              <button
                class="mt-3 w-full text-left px-3 py-4 rounded-lg bg-blue-50 text-blue-700 flex items-center gap-3 hover:bg-blue-500/60"
              >
                <i class="fa-solid fa-comments"></i> AI Assistant Chat
              </button>
            </a>
          </div>
        </div>

        <div class="text-sm text-green-500">
          <div class="mt-6">
            <a class="flex items-center gap-2" href="#"
              ><i class="fa-regular fa-circle-question"></i> Help & Support</a
            >
          </div>
          <div class="mt-4">
            <a class="flex items-center gap-2" href="#"
              ><i class="fa-solid fa-right-from-bracket"></i> Sign Out</a
            >
          </div>
          <div class="mt-6 text-xs text-green-400">Â© 2025 Abiagrow.connect</div>
        </div>
      </aside>

      <!-- MAIN CHAT AREA -->
      <div class="flex-1 flex gap-4 justify-center pt-6">
        <!-- History Panel -->
        <div class="history-panel w-60 flex flex-col">
          <div
            class="new-chat-btn cursor-pointer px-3 py-2 bg-green-100 rounded-lg text-green-700 font-semibold hover:bg-green-200"
            onclick="startNewChat()"
          >
            + New Chat
          </div>
          <p class="font-semibold text-green-700 mt-2">Chat History</p>
          <div
            id="historyList"
            class="flex-1 flex flex-col gap-2 overflow-y-auto mt-2"
          >
            <p class="text-gray-400">No chats yet</p>
          </div>
        </div>

        <!-- Chat Box -->
        <div
          class="w-[60%] h-[85vh] bg-white rounded-xl border shadow-sm flex flex-col"
        >
          <!-- Header -->
          <div class="p-4 border-b flex items-center gap-3 bg-green-50">
            <div
              class="w-10 h-10 bg-green-600 rounded-full flex items-center justify-center"
            >
              <i class="fa-solid fa-seedling text-white text-lg"></i>
            </div>
            <div>
              <p class="text-lg font-bold">Chat With Farmpadi</p>
            </div>
          </div>

          <!-- Chat Messages -->
          <div
            id="chatBody"
            class="flex-1 overflow-y-auto p-6 space-y-4 bg-gray-50"
          ></div>

          <!-- Typing -->
          <div
            id="typing"
            class="hidden w-full flex items-center gap-2 px-6 mb-2"
          >
            <div
              class="w-10 h-10 rounded-full bg-green-600 flex items-center justify-center text-white animate-bounce-slow"
            >
              ðŸ¤–
            </div>
            <div
              class="flex items-center gap-1 bg-white px-3 py-2 rounded-full shadow-sm"
            >
              <span
                class="w-2 h-2 bg-gray-500 rounded-full animate-bounce"
              ></span>
              <span
                class="w-2 h-2 bg-gray-500 rounded-full animate-bounce delay-150"
              ></span>
              <span
                class="w-2 h-2 bg-gray-500 rounded-full animate-bounce delay-300"
              ></span>
            </div>
          </div>

          <!-- Input -->
          <form
            id="chatForm"
            class="p-4 border-t bg-white flex items-center gap-3"
          >
            <input
              id="chatInput"
              type="text"
              class="flex-1 p-3 bg-gray-100 border rounded-xl focus:outline-green-600"
              placeholder="Write a messageâ€¦"
            />
            <button
              class="bg-green-600 hover:bg-green-700 text-white px-5 py-3 rounded-xl"
            >
              <i class="fa-solid fa-paper-plane"></i>
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- FLOATING MARKETPLACE BUTTON WITH LABEL -->
    <div class="fixed bottom-6 right-6 flex flex-col items-center z-50">
      <a
        href="/marketplace"
        class="w-16 h-16 bg-green-600 text-white rounded-full shadow-xl flex items-center justify-center hover:scale-110 transition-transform duration-200"
      >
        <i class="bi bi-shop text-3xl"></i>
      </a>
      <span class="mt-2 text-sm font-semibold text-black">Marketplace</span>
    </div>

    <!-- Chat JS -->
    <script>
      const chatForm = document.getElementById("chatForm");
      const chatInput = document.getElementById("chatInput");
      const chatBody = document.getElementById("chatBody");
      const typing = document.getElementById("typing");

      // Function to scroll to bottom
      function scrollToBottom() {
        chatBody.scrollTop = chatBody.scrollHeight;
      }

      // Function to add a chat bubble
      function addMessage(content, isUser = true) {
        const msgDiv = document.createElement("div");
        msgDiv.className = isUser
          ? "flex justify-end"
          : "flex items-start gap-3";
        msgDiv.innerHTML = isUser
          ? `<div class="bg-green-600 text-white p-3 rounded-xl shadow-sm max-w-[70%] animate-fade-in">${content}</div>`
          : `<div class="w-8 h-8 rounded-full bg-green-600 flex items-center justify-center text-white">ðŸ¤–</div>
       <div class="bg-white p-3 rounded-xl shadow-sm max-w-[70%] animate-fade-in">${content}</div>`;
        chatBody.appendChild(msgDiv);
        scrollToBottom();
      }

      // Send user message and get AI response
      chatForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const message = chatInput.value.trim();
        if (!message) return;

        addMessage(message, true);
        chatInput.value = "";

        // Show typing animation
        typing.classList.remove("hidden");
        scrollToBottom();

        try {
          const response = await fetch(
            "https://agro-hub-ai-server.vercel.app/get-users-prompt",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ prompt: message }),
            }
          );

          const data = await response.json();
          const aiText = data || "Sorry, I couldn't process your message.";

          // Hide typing animation and show AI response
          typing.classList.add("hidden");
          addMessage(aiText, false);
        } catch (error) {
          typing.classList.add("hidden");
          addMessage("Error connecting to AI server. Try again later.", false);
          console.error(error);
        }
      });

      // Start a new chat
      function startNewChat() {
        chatBody.innerHTML = "";
      }
    </script>
  </body>
</html>
